import{b as J,u as G,r as o,j as e}from"./index-CMkW7rST.js";import X from"./ChosseScript-DA07d0eL.js";const Y=()=>{const{mode:m}=J(),z=G(),[x,u]=o.useState(null),[v,g]=o.useState(!1),[h,p]=o.useState(""),[E,i]=o.useState(""),[w,L]=o.useState("ar-ar"),[M,j]=o.useState(""),[D,N]=o.useState(!1),[_,f]=o.useState(!0),[b,k]=o.useState(!1),[C,T]=o.useState(0),[S,A]=o.useState(null);o.useEffect(()=>{m&&["ar-ar","ar-en","en-ar","en-en"].includes(m)&&(L(m),f(!1))},[m]);const P=t=>{if(t.target.files&&t.target.files[0]){const s=t.target.files[0];if(s.size>25*1024*1024){i("File size must be less than 25MB");return}u(s),j(s.name),i("")}},R=()=>{S&&(z(`/transcribeDetails/${S}`),A(null),i(""),u(null),j(""),p(""),f(!1))},$=async t=>{const s=await fetch("https://api.assemblyai.com/v2/transcript",{method:"POST",headers:{authorization:"9b452376153748d6a5e309b408059e81","content-type":"application/json"},body:JSON.stringify({audio_url:t,language_detection:!0,punctuate:!1,speech_understanding:void 0})}),n=await s.json();if(!s.ok)throw new Error(n.error||"Failed to start language detection");for(;;){const r=await(await fetch(`https://api.assemblyai.com/v2/transcript/${n.id}`,{headers:{authorization:"9b452376153748d6a5e309b408059e81","content-type":"application/json"}})).json();if(r.status==="completed")return r.language_code||r.detected_language||null;if(r.status==="error")throw new Error(r.error||"Failed to detect language");await new Promise(d=>setTimeout(d,1500))}},B=t=>new Promise((s,n)=>{try{const a=new XMLHttpRequest;if(a.open("POST","https://api.assemblyai.com/v2/upload"),a.setRequestHeader("authorization","9b452376153748d6a5e309b408059e81"),t&&t.type)try{a.setRequestHeader("content-type",t.type)}catch{}a.upload.onprogress=r=>{if(r.lengthComputable){const d=Math.round(r.loaded/r.total*100);T(d)}},a.onreadystatechange=()=>{if(a.readyState===4)if(a.status>=200&&a.status<300)try{const r=JSON.parse(a.responseText);s(r)}catch{n(new Error("Failed to read upload response"))}else n(new Error("File upload failed"))},a.onerror=()=>n(new Error("Connection error during upload")),a.send(t)}catch(a){n(a)}}),H=t=>{t.preventDefault(),N(!0)},O=()=>{N(!1)},W=t=>{if(t.preventDefault(),N(!1),t.dataTransfer.files&&t.dataTransfer.files[0]){const s=t.dataTransfer.files[0];if(s.size>25*1024*1024){i("File size must be less than 25MB");return}u(s),j(s.name),i("")}},y=t=>{const s={"ar-ar":{language_code:"ar",targetLanguage:"ar",label:"Arabic to Arabic",description:"Convert Arabic audio to Arabic text"},"ar-en":{language_code:"ar",targetLanguage:"en",label:"Arabic to English",description:"Convert Arabic audio to English text"},"en-ar":{language_code:"en",targetLanguage:"ar",label:"English to Arabic",description:"Convert English audio to Arabic text"},"en-en":{language_code:"en",targetLanguage:"en",label:"English to English",description:"Convert English audio to English text"}};return s[t]||s["ar-ar"]},U=async()=>{if(!x){i("Please select an audio file first");return}g(!0),i(""),p("");const t=y(w),s=t.language_code!==t.targetLanguage;try{k(!0),T(0);const n=await B(x);k(!1);let a=null;try{a=await $(n.upload_url)}catch(l){console.warn("Language detection failed, proceeding anyway:",l)}if(a&&a!==t.language_code){const l=`${a}-${t.targetLanguage}`,I=["ar-ar","ar-en","en-ar","en-en"].includes(l)?l:`${a}-${a}`;A(I),g(!1),i(a==="en"?"The uploaded file is in English, but you selected Arabic as the source language. Please switch to the appropriate script.":"The uploaded file is in Arabic, but you selected English as the source language. Please switch to the appropriate script.");return}const r=await fetch("https://api.assemblyai.com/v2/transcript",{method:"POST",body:JSON.stringify({audio_url:n.upload_url,language_code:t.language_code,speaker_labels:!0,punctuate:!0,format_text:!0,...s&&{speech_understanding:{request:{translation:{target_languages:[t.targetLanguage]}}}}}),headers:{authorization:"9b452376153748d6a5e309b408059e81","content-type":"application/json"}}),d=await r.json();if(!r.ok)throw new Error(d.error||"Failed to start conversion process");const F=async()=>{try{const c=await(await fetch(`https://api.assemblyai.com/v2/transcript/${d.id}`,{headers:{authorization:"9b452376153748d6a5e309b408059e81","content-type":"application/json"}})).json();if(console.log("Transcription status:",c.status),c.status==="completed")s&&c.translated_texts&&c.translated_texts[t.targetLanguage]?p(c.translated_texts[t.targetLanguage]||"No translated text available"):p(c.text||"No text available"),g(!1);else{if(c.status==="error")throw new Error(c.error||"Failed to convert audio to text");setTimeout(F,2e3)}}catch(l){console.error("Error checking status:",l),i(`Error: ${l.message}`),g(!1)}};F()}catch(n){console.error("Error transcribing audio:",n),i(`An error occurred: ${n.message||"Please try again"}`),g(!1),k(!1)}},V=()=>e.jsxs("div",{className:`border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-colors ${D?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400"}`,onDragOver:H,onDragLeave:O,onDrop:W,onClick:()=>document.getElementById("audio-upload").click(),children:[e.jsx("input",{id:"audio-upload",type:"file",accept:"audio/*",className:"hidden",onChange:P}),e.jsxs("div",{className:"flex flex-col items-center justify-center space-y-2",children:[e.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M9 13h6m-3-3v6m5 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-lg font-medium text-gray-700",children:M||"Drag and drop an audio file here"}),e.jsx("p",{className:"text-sm text-gray-500",children:"or click to select from your device (max 25MB)"})]})]}),q=()=>e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Transcription Result:"}),e.jsx("div",{className:"px-3 py-1 bg-blue-100 text-blue-800 text-sm font-medium rounded-full",children:y(w).label})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg border border-gray-200 shadow-sm",children:h?e.jsx("p",{className:"whitespace-pre-line text-gray-800",children:h}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{children:"Transcribed text will appear here"})})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>{p(""),u(null),f(!0)},className:"px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900",children:"Start New Conversion"})})]});return e.jsx("div",{className:"max-w-3xl mx-auto p-4 md:p-6",children:e.jsxs("div",{className:"bg-background2 rounded-xl shadow-sm pt-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-center text-text1 mb-2",children:"Audio to Text Conversion"}),e.jsx("p",{className:"text-text1 text-center",children:"Convert your audio files to text with high accuracy"}),!_&&e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:y(w).label})}),e.jsx("div",{className:"mt-4"}),_?e.jsx(X,{onChoose:t=>{L(t),f(!1)},getLanguageSettings:y}):e.jsxs(e.Fragment,{children:[h?q():V(),!h&&x&&e.jsxs("div",{className:"mt-4 flex items-center justify-between p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"text-sm font-medium text-text1",children:M})]}),e.jsx("button",{onClick:()=>u(null),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),b&&e.jsxs("div",{className:"mt-4 bg-background2",children:[e.jsx("div",{className:"h-3 w-full bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-3 bg-blue-600 transition-all",style:{width:`${C}%`}})}),e.jsxs("div",{className:"mt-2 text-sm text-text1 text-center",children:["Uploading file... ",C,"%"]})]}),E&&e.jsxs("div",{className:"mt-4 p-3 bg-red-50 text-red-700 rounded-lg text-sm",children:[e.jsx("div",{children:E}),S&&e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx("button",{onClick:R,className:"px-3 py-1.5 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700",children:"Go to the appropriate script"}),e.jsx("button",{className:"px-3 py-1.5 bg-gray-200 text-gray-800 rounded-md text-sm hover:bg-gray-300",children:"Choose another mode"})]})]}),!h&&x&&e.jsx("button",{onClick:U,disabled:v||b,className:`mt-6 w-full py-3 px-6 rounded-lg text-black font-medium duration-300 shadow-lg shadow-gray-400 text-lg flex items-center justify-center space-x-2 ${v||b?"bg-background2 cursor-not-allowed":"bg-gray-300 hover:bg-gray-400 dark:hover:bg-gray-700 dark:hover:text-white cursor-pointer"}`,children:b?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Uploading file... ",C,"%"]}):v?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Converting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-6-18v4m0 0H8m4 0h4M5 7a2 2 0 100-4 2 2 0 000 4z"})}),e.jsx("span",{children:"Start Conversion"})]})})]})]})})};export{Y as default};
